import { Handler, Context} from 'aws-lambda';
import { DynamoDBClient, ListTablesCommand, GetItemCommand, BatchGetItemCommand, BatchGetItemInput, KeysAndAttributes, BatchGetItemCommandOutput, BatchGetItemCommandInput} from '@aws-sdk/client-dynamodb'
import { DynamoDBDocumentClient, BatchGetCommand, BatchGetCommandInput, BatchGetCommandOutput, Query } from "@aws-sdk/lib-dynamodb"; // ES6 import

export async function articleSeenBefore(articlesArr){

    let keys = articlesArr.map((item) => { 
      let sortKey = item.doi ? "doi#" + item.doi : "pmid#" + item.pmid
      return ({
        "resource-name": "pubmedArticle",
        "sort-key": sortKey
      })
    })
  keys.push({
        "resource-name": "pubmedArticle",
        "sort-key": "doi#10.1016/j.psj.2023.102679"
      })
  keys.push({
        "resource-name": "test",
        "sort-key": "testing"
      })

  console.log("KEYS ------------")
  console.log(keys)
  const AWS_REGION: string = 'us-east-1'
  const baseClient = new DynamoDBClient({ region: AWS_REGION });
  const client = DynamoDBDocumentClient.from(baseClient); // client is DynamoDB client
  const TABLE_NAME: string = 'discordResources'

  //const query: Query = 

  const batchInputForDocClient: BatchGetCommandInput = {
    RequestItems: {
      [TABLE_NAME]: {
         Keys: keys,
        //Do you need these two? vvv
      // ProjectionExpression: "#S, serverMap",
      // ExpressionAttributeNames: {"#S": "sort-key"}
      }
    },
    ReturnConsumedCapacity: "INDEXES"
  }

  let testInput = new BatchGetCommand(batchInputForDocClient)
  // TODO let sortKeyToRSSArticleMap = {}
  const results = await client.send(testInput);
  let resWithoutMetadata = results.Responses[TABLE_NAME]// removing this for now to see the metadata while debugging
  
  console.log("resWithoutMetadata---------")
  console.log(resWithoutMetadata)

  return resWithoutMetadata
}

const articleArr = [{"title":"A retrospective cohort study of the characteristics of unsuccessful operative vaginal deliveries","description":"CONCLUSION: Risk factors for unsuccessful OVD were higher birth weight and induction of labour. There was a higher incidence of postpartum haemorrhage and NICU admission when compared with successful OVD.","author":{"name":"D Kane et al."},"pmid":"37120912","url":"https://pubmed.ncbi.nlm.nih.gov/37120912","doi":"10.1016/j.ejogrb.2023.04.021"},{"title":"Medical management of retained products of conception: A prospective observational study","description":"CONCLUSION(S): For patients presenting with secondary PPH and sonographic RPOC, over two thirds required surgical management. Increased endometrial thickness was associated with an increased requirement for surgical management.","author":{"name":"Rhea L Schulte et al."},"pmid":"37120911","url":"https://pubmed.ncbi.nlm.nih.gov/37120911","doi":"10.1016/j.ejogrb.2023.04.012"},{"title":"CTG interpretation templates affect residents' decision making","description":"CONCLUSION: The perceived need for intervention by residents interpreting CTGs was significantly affected by the guidelines in use. The difference in decisions were less pronounced than the difference in classification. The sensitivity for both perceived need for intervention and for classification pathological to identify acidosis was higher with SWE09, and the specificity higher with SWE17, when assessed by the two comparable groups of residents.","author":{"name":"Frida Ekengård et al."},"pmid":"37120910","url":"https://pubmed.ncbi.nlm.nih.gov/37120910","doi":"10.1016/j.ejogrb.2023.04.022"},{"title":"Multi-organ dysfunction in infants with acidosis at birth in the absence of moderate to severe hypoxic ischemic encephalopathy","description":"CONCLUSIONS: Moderate to severe fetal acidosis is associated with the development of extra-cranial organ dysfunctions in infants who do not require therapeutic hypothermia. A monitoring protocol is needed for infants with mild asphyxia in order to identify and manage potential complications. Coagulation system should be carefully evaluated.","author":{"name":"Nihal Demirel et al."},"pmid":"37120904","url":"https://pubmed.ncbi.nlm.nih.gov/37120904","doi":"10.1016/j.earlhumdev.2023.105775"},{"title":"Modification of serum fatty acids in preterm infants by parenteral lipids and enteral docosahexaenoic acid/arachidonic acid: A secondary analysis of the Mega Donna Mega trial","description":"CONCLUSIONS: Our data show that parenteral lipids aggravate the postnatal loss of LCPUFAs seen in preterm infants and that serum AA available for accretion is below that in utero. Further research is needed to establish optimal postnatal fatty acid supplementation and profiles in extremely preterm infants to promote development and long-term health.","author":{"name":"Ulrika Sjöbom et al."},"pmid":"37120902","url":"https://pubmed.ncbi.nlm.nih.gov/37120902","doi":"10.1016/j.clnu.2023.04.020"},{"title":"Liposomal encapsulated oregano, cinnamon, and clove oils enhanced the performance, bacterial metabolites antioxidant potential, and intestinal microbiota of broiler chickens","description":"Encapsulated phytochemicals with augmented therapeutic and nutritional characteristics have become promising alternatives to antimicrobials in the poultry industry. Hence, our key target was to explore the efficacy of liposomal encapsulation, as a novel carrier, for essential oils (LEOs) on growth, digestibility, intestinal microbiota, and bacterial metabolites of broiler chickens. Moreover, the impact of encapsulated EOs on transcription mechanisms targeting the genes encoding digestive...","author":{"name":"Ahmed M A Meligy et al."},"pmid":"37120892","url":"https://pubmed.ncbi.nlm.nih.gov/37120892","doi":"10.1016/j.psj.2023.102683"},{"title":"Effect of dietary Saccharomyces-derived prebiotic refined functional carbohydrates as antibiotic alternative on growth performance and intestinal health of broiler chickens reared in a commercial farm","description":"The search for effective in-feed antibiotic alternative is growing due to the global trend to reduce or ban the utilization of antibiotics as growth promotors in poultry diets. This study was processed to assess the effect of dietary refined functional carbohydrates (RFCs) replacing antibiotic growth promoters (AGP) on growth performance, intestinal morphologic structure and microbiota, as well as intestinal immune function and barrier function of broilers reared on a commercial broilers farm....","author":{"name":"Wenrui Zhen et al."},"pmid":"37120891","url":"https://pubmed.ncbi.nlm.nih.gov/37120891","doi":"10.1016/j.psj.2023.102671"},{"title":"An analysis of nutritional risk factors in older adults with gastrointestinal tumours","description":"INTRODUCTION: The aim of this study was to investigate risk factors for nutritional risk in older adults with gastrointestinal tumours.","author":{"name":"Jingxia Qiu et al."},"pmid":"37120888","url":"https://pubmed.ncbi.nlm.nih.gov/37120888","doi":"10.1016/j.jgo.2023.101499"},{"title":"High-Performance Visible-Light Photocatalysts for H<sub>2</sub> Production: Rod-Shaped Co<sub>3</sub>O<sub>4</sub>/CoO/Co<sub>2</sub>P Heterojunction Derived from Co-MOF-74","description":"Photocatalyst systems generally consist of catalysts and cocatalysts to realize light capture, charge carrier migration, and surface redox reactions. Developing a single photocatalyst that performs all functions while minimizing efficiency loss is extremely challenging. Herein, rod-shaped photocatalysts Co(3)O(4)/CoO/Co(2)P are designed and prepared using Co-MOF-74 as a template, which displays an outstanding H(2) generation rate of 6.00 mmol·g^(-1)·h^(-1) when exposed to visible light...","author":{"name":"Yi-Shan Ouyang & Qing-Yuan Yang"},"pmid":"37120883","url":"https://pubmed.ncbi.nlm.nih.gov/37120883","doi":"10.1016/j.jcis.2023.04.078"},{"title":"Facile construction of a robust CuS@NaNbO<sub>3</sub> nanorod composite: A unique p-n heterojunction structure with superior performance in photocatalytic hydrogen evolution","description":"The construction of heterojunctions is commonly regarded as an efficient way to promote the production of hydrogen via photocatalytic water splitting through the enhancement of interfacial interactions. The p-n heterojunction is an important kind of heterojunction with an inner electric field based on the different properties of semiconductors. In this work, we reported the synthesis of a novel CuS/NaNbO(3) p-n heterojunction by depositing CuS nanoparticles on the external surface of NaNbO(3)...","author":{"name":"Shengyuan Chang et al."},"pmid":"37120879","url":"https://pubmed.ncbi.nlm.nih.gov/37120879","doi":"10.1016/j.jcis.2023.04.111"},{"title":"Carcass composition, meat quality, leg muscle status, and its mRNA expression profile in broilers affected by valgus-varus deformity","description":"Valgus-varus deformity (VVD) is a common leg disease in commercial broilers, which seriously affects animal welfare and causes economic losses. Up to now, most of the studies on VVD have been on skeleton, whereas there are fewer studies on VVD muscle. In this study, carcass composition and meat quality of 35-day-old normal and VVD Cobb broilers assess the effect of VVD on broiler growth. Molecular biology, morphology, and RNA sequencing (RNA-seq) were used to study the difference between normal...","author":{"name":"Chunxia Cai et al."},"pmid":"37120872","url":"https://pubmed.ncbi.nlm.nih.gov/37120872","doi":"10.1016/j.psj.2023.102682"},{"title":"Characterization of ovarian follicles, serum steroid hormone concentration, and steroidogenic gene expression profiles in the developing ovarian follicles in White King pigeons","description":"Paired pigeons only lay 2 eggs in a laying period, which is closely related to ovarian follicle development, but this process is not well understood. In this study, 60 pairs of 12-mo-old White King pigeons were selected and serum and follicles were collected at 4 stages of laying interval (LI), including the first (LI1), the third (LI3), the fifth (LI5), and the seventh day (LI7). Morphological results showed that paired pigeons normally had 2 preovulatory follicles and the second-largest...","author":{"name":"Y Wang et al."},"pmid":"37120866","url":"https://pubmed.ncbi.nlm.nih.gov/37120866","doi":"10.1016/j.psj.2023.102673"},{"title":"Secondary Coordination Sphere Alkylation Promotes Cyclometalation","description":"Diphosphines have taken on a dominant role as supporting ligands in transition-metal chemistry. Here, we describe complexes of the type [Cp*Fe(diphosphine)(X)] (X = Cl, H) where for diphosphine = 1,2-bis(di-allylphosphino)ethane (tape), a Lewis-acidic secondary coordination sphere (SCS) was installed via allyl group hydroboration using dicyclohexylborane (HBCy(2)). The resulting chloride complex, [Cp*Fe(P(2)B^(Cy)(4))(Cl)] (P(2)B^(Cy)(4) = 1,2-bis(di(3-cyclohexylboranyl)propylphosphino)ethane),...","author":{"name":"Joseph A Zurakowski et al."},"pmid":"37120856","url":"https://pubmed.ncbi.nlm.nih.gov/37120856","doi":"10.1021/acs.inorgchem.3c00427"},{"title":"Effective Enhancement of the Ferroelectric Performance of Polar Co-Gallate MOF by Doping M<sup>2+</sup> Ions (M = Mg, Mn, Ni) into Framework Nodes","description":"MOF ferroelectrics have been demonstrated to be a promising candidate owing to various structures and controllable properties. However, weak ferroelectricity hampers their boom. Herein, a convenient strategy, doping metal ions into the framework nodes of parent MOF, is adopted to enhance ferroelectric performance. A series of M-doped Co-Gallate (M = Mg, Mn, Ni) were synthesized to improve ferroelectric properties. The electrical hysteresis loop demonstrated its ferroelectric behaviors,...","author":{"name":"Meiying Liu et al."},"pmid":"37120854","url":"https://pubmed.ncbi.nlm.nih.gov/37120854","doi":"10.1021/acs.inorgchem.3c00300"},{"title":"The Brazilian version of the World Health Organization Disability Assessment Schedule (WHODAS 2.0) is reliable and valid for chronic stroke survivors","description":"CONCLUSIONS: The Brazilian version of the WHODAS 2.0 instrument presented evidence of reliability and validity for chronic post-stroke individuals.","author":{"name":"Angélica Cristiane Ovando et al."},"pmid":"37120851","url":"https://pubmed.ncbi.nlm.nih.gov/37120851","doi":"10.1080/10749357.2023.2207293"},{"title":"Relationships between cardiorespiratory fitness, physical activity practices, and functional outcomes one-year post-stroke in northern Benin: A case-control study","description":"CONCLUSION: The study showed clear trends for lower levels of PA in both people with chronic stroke and health controls. A correlation exists between CF, disability, and functional outcomes among stroke patients.","author":{"name":"Oyéné Kossi et al."},"pmid":"37120850","url":"https://pubmed.ncbi.nlm.nih.gov/37120850","doi":"10.1080/10749357.2023.2207286"},{"title":"Are credit scores and financial well-being associated with physical health?","description":"Consumer credit score has been used as an indicator of financial strain that could potentially impact health. Subjective financial well-being, or one's feelings about one's expectations, preferences, and satisfaction with their financial situation, is related to financial strain. This study examined whether subjective financial well-being mediates the association between credit score and self-reported physical health in a national representative sample. Using structural equation modeling (SEM),...","author":{"name":"Julie Birkenmaier et al."},"pmid":"37120849","url":"https://pubmed.ncbi.nlm.nih.gov/37120849","doi":"10.1080/00981389.2023.2207614"},{"title":"Site Selectivity for the Spin States and Spin Crossover in Undecanuclear Heterometallic Cyanido-Bridged Clusters","description":"Polynuclear molecular clusters offer an opportunity to design new hierarchical switchable materials with collective properties, based on variation of the chemical composition, size, shapes, and overall building blocks organization. In this study, we rationally designed and constructed an unprecedented series of cyanido-bridged nanoclusters realizing new undecanuclear topology: Fe^(II)[Fe^(II)(bzbpen)](6)[W^(V)(CN)(8)](2)[W^(IV)(CN)(8)](2)·18MeOH (1),...","author":{"name":"Le Shi et al."},"pmid":"37120844","url":"https://pubmed.ncbi.nlm.nih.gov/37120844","doi":"10.1021/acs.inorgchem.3c00325"},{"title":"Effect of blood pressure variability on hypertensive retinopathy","description":"CONCLUSION: Hypertensive retinopathy is related to BPV. In clinical practice, we can assess the degree of BPV and retinopathy in hypertensive patients to track the progression of hypertension-mediated organ damage (HMOD). Correction of BPV may help treat or postpone the progression of HOMD.","author":{"name":"Lei Jiao et al."},"pmid":"37120839","url":"https://pubmed.ncbi.nlm.nih.gov/37120839","doi":"10.1080/10641963.2023.2205050"},{"title":"CRISPR-Cas12a Coupled with DNA Nanosheet-Amplified Fluorescence Anisotropy for Sensitive Detection of Biomolecules","description":"DNA nanosheets (DNSs) have been utilized effectively as a fluorescence anisotropy (FA) amplifier for biosensing. But, their sensitivity needs to be further improved. Herein, CRISPR-Cas12a with strong trans-cleavage activity was utilized to enhance the FA amplification ability of DNSs for the sensitive detection of miRNA-155 (miR-155) as a proof-of-principle target. In this method, the hybrid of the recognition probe of miR-155 (T1) and a blocker sequence (T2) was immobilized on the surface of...","author":{"name":"Tian Jin Xie et al."},"pmid":"37120835","url":"https://pubmed.ncbi.nlm.nih.gov/37120835","doi":"10.1021/acs.analchem.3c00156"}]

articleSeenBefore(articleArr)
